<navigation-bar title="心灵报告" back="{{true}}" color="white" background="#121212" bind:heightready="onNavBarHeightReady"></navigation-bar>

<scroll-view class="report-container" scroll-y>
  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在分析你的潜意识...</text>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!isLoading && totalDreams === 0}}">
    <image class="empty-icon svg-icon" src="/images/icons/chart.svg" mode="aspectFit"></image>
    <text class="empty-title">还没有足够的数据</text>
    <text class="empty-subtitle">记录至少3个梦境后，就能生成你的心灵报告了</text>
    <view class="start-btn" bindtap="goToChat">开始记录</view>
  </view>

  <!-- 报告内容 -->
  <block wx:if="{{!isLoading && totalDreams > 0}}">
    <!-- 头部统计 -->
    <view class="header-section">
      <view class="stat-cards">
        <view class="stat-card">
          <text class="stat-number">{{totalDreams}}</text>
          <text class="stat-label">记录梦境</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{avgClarity}}</text>
          <text class="stat-label">平均清晰度</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{dominantMood}}</text>
          <text class="stat-label">主导情绪</text>
        </view>
      </view>
    </view>

    <!-- Persona / Shadow -->
    <view class="section">
      <view class="section-title">人格面具与阴影</view>
      <view class="polarity-bar">
        <view class="polarity-label left">
          <text class="label-title">Persona 面具</text>
          <text class="label-desc">意识层面</text>
        </view>
        <view class="bar-container">
          <view class="bar-bg">
            <view class="bar-fill" style="width: {{personaPercentage}}%"></view>
          </view>
          <view class="balance-indicator" style="left: {{personaPercentage}}%">
            <view class="indicator-dot"></view>
          </view>
        </view>
        <view class="polarity-label right">
          <text class="label-title">Shadow 阴影</text>
          <text class="label-desc">潜意识层面</text>
        </view>
      </view>
      <view class="insight-box">
        <text class="insight-text">{{polarityInsight}}</text>
      </view>
    </view>

    <!-- 原型雷达图 -->
    <view class="section">
      <view class="section-title">原型能量分布</view>
      <view class="section-subtitle">基于荣格12原型理论</view>
      <view class="radar-container">
        <canvas type="2d" id="radarCanvas" class="radar-canvas"></canvas>
      </view>
      <view class="archetype-legend">
        <view class="legend-item" wx:for="{{archetypes}}" wx:key="name">
          <text class="legend-icon">{{item.icon}}</text>
          <text class="legend-name">{{item.name}}</text>
          <text class="legend-value">{{item.value}}</text>
        </view>
      </view>
    </view>

    <!-- 情绪分布 -->
    <view class="section" wx:if="{{moodDistribution.length > 0}}">
      <view class="section-title">情绪分布</view>
      <view class="mood-bars">
        <view class="mood-bar-item" wx:for="{{moodDistribution}}" wx:key="mood">
          <text class="mood-name">{{item.mood}}</text>
          <view class="bar-wrapper">
            <view class="bar" style="width: {{item.percentage}}%"></view>
          </view>
          <text class="mood-count">{{item.count}}次 ({{item.percentage}}%)</text>
        </view>
      </view>
    </view>

    <!-- 反复出现的意象 -->
    <view class="section" wx:if="{{recurrentSymbols.length > 0}}">
      <view class="section-title">反复出现的意象</view>
      <view class="section-subtitle">这些可能是你潜意识的核心符号</view>
      <view class="symbols-cloud">
        <view class="symbol-tag" wx:for="{{recurrentSymbols}}" wx:key="*this">
          {{item}}
        </view>
      </view>
    </view>

    <!-- 底部间距 -->
    <view style="height: 60rpx;"></view>
  </block>
</scroll-view>

<!-- 分享按钮 -->
<view class="share-btn" bindtap="shareReport" wx:if="{{totalDreams > 0}}">
  <image class="share-icon svg-icon" src="/images/icons/share.svg" mode="aspectFit" style="width: 32rpx; height: 32rpx; margin-right: 8rpx;"></image>
  <text class="share-text">分享报告</text>
</view>
