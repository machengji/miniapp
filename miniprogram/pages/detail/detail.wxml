<!-- æ¢¦å¢ƒè¯¦æƒ…é¡µ -->
<navigation-bar title="æ¢¦å¢ƒè¯¦æƒ…" back="{{true}}" color="white" background="#121212" bindback="goBack"></navigation-bar>

<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¦æƒ…å†…å®¹ -->
  <block wx:if="{{!isLoading && dream}}">
    <!-- å¤´éƒ¨ä¿¡æ¯ -->
    <view class="header-section">
      <view class="date-badge">
        <text class="date-text">{{formattedDate}}</text>
      </view>
      <view class="mood-badge" style="background: {{moodColor}}20; color: {{moodColor}}">
        <text class="mood-icon">{{moodIcon}}</text>
        <text class="mood-text">{{dream.mood || 'æœªæ ‡è®°'}}</text>
      </view>
    </view>

    <!-- æ ‡é¢˜ -->
    <view class="title-section">
      <text class="dream-title">{{dream.summary || 'æ— é¢˜æ¢¦å¢ƒ'}}</text>
    </view>

    <!-- å…ƒæ•°æ® -->
    <view class="meta-section">
      <view class="meta-item">
        <text class="meta-label">æ¸…æ™°åº¦</text>
        <view class="clarity-bar">
          <view class="clarity-fill" style="width: {{dream.clarity * 20}}%; background: {{moodColor}}"></view>
        </view>
        <text class="clarity-value">{{dream.clarity}}/5</text>
      </view>
    </view>

    <!-- å…³é”®è¯ -->
    <view class="keywords-section" wx:if="{{dream.keywords && dream.keywords.length > 0}}">
      <text class="section-label">å…³é”®è¯</text>
      <view class="keywords-list">
        <text class="keyword-tag" wx:for="{{dream.keywords}}" wx:key="*this">{{item}}</text>
      </view>
    </view>

    <!-- åŸå§‹å†…å®¹ -->
    <view class="content-section">
      <text class="section-label">æ¢¦å¢ƒè®°å½•</text>
      <view class="content-box">
        <text class="content-text" user-select="true">{{dream.content}}</text>
      </view>
    </view>

    <!-- AIåˆ†æ -->
    <view class="analysis-section">
      <view class="section-header">
        <text class="section-label">AIåˆ†æ</text>
        <view class="copy-btn" bindtap="copyAnalysis">
          <text class="copy-icon">ğŸ“‹</text>
          <text class="copy-text">å¤åˆ¶</text>
        </view>
      </view>

      <!-- æ€è€ƒè¿‡ç¨‹ -->
      <view class="thought-box" wx:if="{{dream.thought}}">
        <view class="thought-header" bindtap="toggleThought">
          <view class="thought-title">
            <text class="brain-icon">âœ¦</text>
            <text>æ·±åº¦åˆ†æå›è·¯</text>
          </view>
          <text class="toggle-icon {{isThoughtExpanded ? 'expanded' : ''}}">â–¼</text>
        </view>
        <view class="thought-content" wx:if="{{isThoughtExpanded}}">
          <text user-select="true">{{dream.thought}}</text>
        </view>
      </view>

      <!-- åˆ†ææ­£æ–‡ -->
      <view class="analysis-box">
        <text class="analysis-text" user-select="true">{{dream.content}}</text>
      </view>
    </view>

    <!-- 12åŸå‹å¾—åˆ†ï¼ˆå¦‚æœæœ‰ï¼‰ -->
    <view class="archetype-section" wx:if="{{dream.archetypeScores}}">
      <text class="section-label">åŸå‹èƒ½é‡åˆ†å¸ƒ</text>
      <view class="archetype-list">
        <view class="archetype-item" wx:for="{{[['å¤©çœŸè€…','innocent'],['å­¤å„¿','orphan'],['è‹±é›„','hero'],['ç…§é¡¾è€…','caregiver'],['æ¢ç´¢è€…','explorer'],['åå›è€…','rebel'],['æƒ…äºº','lover'],['åˆ›é€ è€…','creator'],['å°ä¸‘','jester'],['æ™ºè€…','sage'],['é­”æœ¯å¸ˆ','magician'],['ç»Ÿæ²»è€…','ruler']]}}" wx:key="*this">
          <text class="archetype-name">{{item[0]}}</text>
          <view class="archetype-bar">
            <view class="archetype-fill" style="width: {{dream.archetypeScores[item[1]] || 20}}%"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-section">
      <button class="share-btn" open-type="share">
        <text class="btn-icon">â†—</text>
        <text class="btn-text">åˆ†äº«</text>
      </button>
      <view class="delete-btn" bindtap="deleteDream">
        <text class="btn-icon">ğŸ—‘</text>
        <text class="btn-text">åˆ é™¤</text>
      </view>
    </view>

    <!-- åº•éƒ¨é—´è· -->
    <view style="height: 60rpx;"></view>
  </block>
</view>
