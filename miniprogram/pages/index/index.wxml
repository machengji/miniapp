<!-- é¦–é¡µï¼šæ¢¦å¢ƒæ—¥è®° + ç”¨æˆ·ç»Ÿè®¡ -->
<navigation-bar title="Aletheia" back="{{false}}" color="white" background="#121212"></navigation-bar>

<scroll-view class="journal-list" scroll-y type="list" refresher-enabled="{{true}}" refresher-triggered="{{isLoading}}" bindrefresherrefresh="onPullDownRefresh">
  
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="header-top">
      <view class="title-section">
        <text class="title">æ¢¦å¢ƒæ—¥å¿—</text>
        <text class="subtitle">è®°å½•æ— æ„è¯†çš„ä½è¯­</text>
      </view>
      <view class="header-actions">
        <view class="daily-card-btn" bindtap="showDailyCard">
          <text class="action-icon">ğŸ´</text>
          <text class="action-badge" wx:if="{{!hasDrawnCard}}">1</text>
        </view>
        <view class="map-btn" bindtap="goToReport">
          <text class="map-icon">ğŸ”®</text>
        </view>
      </view>
    </view>
    
    <!-- ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-card" wx:if="{{stats.totalDreams > 0}}">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalDreams}}</text>
        <text class="stat-label">è®°å½•æ¢¦å¢ƒ</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.streakDays}}</text>
        <text class="stat-label">è¿ç»­å¤©æ•°</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.dominantMood}}</text>
        <text class="stat-label">ä¸»å¯¼æƒ…ç»ª</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{stats.avgClarity}}</text>
        <text class="stat-label">å¹³å‡æ¸…æ™°åº¦</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½•æ ‡é¢˜ -->
  <view class="section-header" wx:if="{{dreams.length > 0}}">
    <text class="section-title">æœ€è¿‘è®°å½•</text>
    <text class="section-count">å…± {{stats.totalDreams}} æ¡</text>
  </view>

  <!-- æ¢¦å¢ƒåˆ—è¡¨ -->
  <view class="dream-card" wx:for="{{dreams}}" wx:key="_id" bindtap="viewDreamDetail" data-id="{{item._id}}">
    <view class="card-date">
      <text class="day">{{item.day}}</text>
      <text class="month">{{item.month}}</text>
    </view>
    <view class="card-content">
      <view class="card-title-row">
        <text class="card-title">{{item.displayTitle}}</text>
        <text class="mood-emoji" style="color: {{item.moodColor}}">{{item.moodIcon}}</text>
      </view>
      <view class="card-meta">
        <text class="mood-tag" style="background: {{item.moodColor}}20; color: {{item.moodColor}}" wx:if="{{item.mood && item.mood !== 'unknown'}}">
          {{item.mood}}
        </text>
        <view class="clarity-bar" wx:if="{{item.clarity}}">
          <view class="clarity-fill" style="width: {{item.clarity * 20}}%; background: {{item.moodColor}}"></view>
        </view>
      </view>
      <text class="card-preview">{{item.content}}</text>
      <!-- å…³é”®è¯æ ‡ç­¾ -->
      <view class="keywords" wx:if="{{item.keywords && item.keywords.length > 0}}">
        <text class="keyword-tag" wx:for="{{item.keywords}}" wx:for-item="kw" wx:key="*this">{{kw}}</text>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{dreams.length === 0 && !isLoading}}">
    <view class="empty-icon">ğŸŒ™</view>
    <text class="empty-title">å°šæœªè®°å½•ä»»ä½•æ¢¦å¢ƒ</text>
    <text class="empty-subtitle">ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®ï¼Œå¼€å¯ä½ çš„æ½œæ„è¯†æ¢ç´¢ä¹‹æ—…</text>
  </view>
  
  <!-- åº•éƒ¨é—´è· -->
  <view style="height: 160rpx;"></view>
</scroll-view>

<!-- æ‚¬æµ®æŒ‰é’® -->
<view class="fab" bindtap="goToChat">
  <text class="fab-icon">+</text>
</view>

<!-- æ¯æ—¥å¡ç‰‡ -->
<daily-card visible="{{showDailyCard}}" bind:close="hideDailyCard" bind:share="onShareCard" />
