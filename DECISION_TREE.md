# Aletheia 技术选型与决策树

> 云开发AI vs 自建方案 - 快速决策指南

---

## 🌳 技术选型决策树

```
是否需要AI对话功能？
│
├─ 否 ────────────────────────────────────────────────► 无需AI，使用静态内容
│
└─ 是
   │
   ├─ 是否已有自建服务器和运维团队？
   │  │
   │  ├─ 是 ─────────────────────────────────────────► 考虑自建API方案
   │  │                                               (更多控制，更高成本)
   │  │
   │  └─ 否
   │      │
   │      ├─ 是否希望1周内上线？
   │      │  │
   │      │  ├─ 是 ──────────────────────────────────► ✅ 云开发AI方案
   │      │  │                                        (3行代码，立即可用)
   │      │  │
   │      │  └─ 否 ──────────────────────────────────► 可评估自建方案
   │      │
   │      ├─ 是否预算有限（< ¥1000/月）？
   │      │  │
   │      │  ├─ 是 ──────────────────────────────────► ✅ 云开发AI方案
   │      │  │                                        (免费额度充足)
   │      │  │
   │      │  └─ 否 ──────────────────────────────────► 可评估自建方案
   │      │
   │      └─ 是否需要定制模型微调？
   │         │
   │         ├─ 是 ──────────────────────────────────► 需自建方案
   │         │                                        (云开发暂不支持微调)
   │         │
   │         └─ 否 ──────────────────────────────────► ✅ 云开发AI方案
   │
   └─ 是否必须支持非微信平台？
      │
      ├─ 是 ─────────────────────────────────────────► 需自建方案
      │                                               (云开发绑定微信生态)
      │
      └─ 否 ─────────────────────────────────────────► ✅ 云开发AI方案
```

---

## 📊 方案对比矩阵

### 技术维度对比

| 评估维度 | 权重 | 云开发AI | 自建服务器 |  winner  |
|----------|------|----------|------------|----------|
| **开发速度** | 20% | ⭐⭐⭐⭐⭐ 3天 | ⭐⭐ 2-4周 | 🏆 云开发 |
| **运维成本** | 15% | ⭐⭐⭐⭐⭐ 0运维 | ⭐⭐ 需专人 | 🏆 云开发 |
| **灵活性** | 15% | ⭐⭐⭐ 受限 | ⭐⭐⭐⭐⭐ 完全控制 | 🏆 自建 |
| **成本控制** | 15% | ⭐⭐⭐⭐ 按量付费 | ⭐⭐⭐ 固定成本 | 🏆 云开发 |
| **安全性** | 10% | ⭐⭐⭐⭐⭐ 微信托管 | ⭐⭐⭐ 自行管理 | 🏆 云开发 |
| **扩展性** | 10% | ⭐⭐⭐⭐ 自动扩容 | ⭐⭐⭐⭐ 需配置 | 平手 |
| **定制化** | 10% | ⭐⭐ 有限 | ⭐⭐⭐⭐⭐ 完全定制 | 🏆 自建 |
| **多平台** | 5% | ⭐⭐ 仅限微信 | ⭐⭐⭐⭐⭐ 全平台 | 🏆 自建 |
| **综合得分** | 100% | **4.35** | **3.25** | 🏆 **云开发** |

### 成本对比（月度，10000MAU场景）

```
┌─────────────────────────────────────────────────────────────────────┐
│                          成本结构对比                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  云开发AI方案                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ AI调用        ████████░░░░░░░░░░░░  ¥580                    │   │
│  │ 云数据库      █░░░░░░░░░░░░░░░░░░░  ¥50                     │   │
│  │ 云存储        ░░░░░░░░░░░░░░░░░░░░  ¥10                     │   │
│  │ 运维人力      ░░░░░░░░░░░░░░░░░░░░  ¥0                      │   │
│  │ 服务器        ░░░░░░░░░░░░░░░░░░░░  ¥0                      │   │
│  │ 域名/备案     ░░░░░░░░░░░░░░░░░░░░  ¥0                      │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 总计: ¥640/月                                               │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  自建服务器方案                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ AI API调用    ████████░░░░░░░░░░░░  ¥500                    │   │
│  │ 服务器租赁    █████░░░░░░░░░░░░░░░  ¥300                    │   │
│  │ CDN/带宽      ██░░░░░░░░░░░░░░░░░░  ¥100                    │   │
│  │ 域名/SSL      ░░░░░░░░░░░░░░░░░░░░  ¥50                     │   │
│  │ 运维人力(20%) ██████████████░░░░░░  ¥2,000                  │   │
│  │ 数据库托管    ███░░░░░░░░░░░░░░░░░  ¥200                    │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │ 总计: ¥3,150/月                                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  💰 云开发AI方案节省: 80%                                           │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🎯 场景匹配指南

### 选择云开发AI的场景 ✅

| 场景 | 说明 |
|------|------|
| **MVP验证** | 快速验证产品概念，3天内上线测试 |
| **预算有限** | 初创团队，无法承担专职运维成本 |
| **微信生态** | 目标用户主要在小程序 |
| **快速迭代** | 需要频繁调整产品方向 |
| **中小规模** | DAU < 10万，云开发资源充足 |
| **无后端团队** | 仅有前端开发资源 |

### 选择自建方案的场景 ⚠️

| 场景 | 说明 |
|------|------|
| **超大规模** | DAU > 100万，需要极致性能优化 |
| **多平台部署** | 需要同时支持iOS/Android/H5/小程序 |
| **深度定制** | 需要微调模型、自定义推理逻辑 |
| **数据合规** | 金融/政务场景，数据必须本地部署 |
| **已有基础设施** | 已有成熟运维团队和技术栈 |
| **复杂业务** | 需要大量后台任务、定时任务 |

---

## 🔧 混合架构方案

### 方案A: 云开发AI为主 + 自建补充

```
┌─────────────────────────────────────────────────────────────┐
│                    用户交互层                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  微信小程序  │  │    H5       │  │     iOS/Android     │ │
│  │ (主要入口)   │  │  (营销活动)  │  │    (可选扩展)       │ │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │
│         │                │                    │            │
│         └────────────────┼────────────────────┘            │
│                          ▼                                 │
├─────────────────────────────────────────────────────────────┤
│                    核心业务层                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │              微信云开发环境                            │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │  AI对话: wx.cloud.extend.AI                    │  │  │
│  │  │  • 流式对话                                     │  │  │
│  │  │  • 长期记忆                                     │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │  数据存储: 云数据库 + 云存储                      │  │  │
│  │  │  • 梦境记录                                     │  │  │
│  │  │  • 用户档案                                     │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                 │
│                          ▼ (特定场景调用)                   │
├─────────────────────────────────────────────────────────────┤
│                    自建补充层                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │              轻量自建服务器                            │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │  复杂后台任务                                    │  │  │
│  │  │  • 批量数据分析                                  │  │  │
│  │  │  • 定时报告生成                                  │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │  第三方API集成                                   │  │  │
│  │  │  • 支付回调处理                                  │  │  │
│  │  │  • 企业微信对接                                  │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**适用**: 主要用户在微信，但需要部分跨平台能力

### 方案B: 多模型备份策略

```typescript
// 智能模型路由
class ModelRouter {
  async chat(input: string, priority: 'speed' | 'quality' = 'speed') {
    // 优先使用云开发AI（低成本、高可用）
    if (priority === 'speed') {
      try {
        return await this.cloudAI.chat(input);
      } catch (err) {
        console.log('云开发AI失败，降级到备用方案');
      }
    }
    
    // 降级到自建API
    return await this.selfHostedAPI.chat(input);
  }
}
```

**适用**: 对可用性要求极高，不能容忍服务中断

---

## 📋 检查清单

### 云开发AI方案上线前检查

- [ ] 已开通云开发环境
- [ ] 已安装AI扩展功能
- [ ] 基础库版本 >= 3.7.1
- [ ] 已配置云数据库权限
- [ ] 已测试流式响应
- [ ] 已处理常见错误场景
- [ ] 已配置预算告警

### 自建方案上线前检查

- [ ] 已申请DeepSeek API Key
- [ ] 已购买服务器/域名
- [ ] 已完成域名备案
- [ ] 已配置HTTPS
- [ ] 已部署API服务
- [ ] 已配置日志监控
- [ ] 已制定容灾方案
- [ ] 已配置自动扩容

---

## 🎓 决策案例

### 案例1: 初创团队（推荐云开发AI）

**背景**:
- 3人团队，2前端1产品
- 预算 ¥5000/月
- 目标：3周内上线MVP

**决策**: ✅ 云开发AI

**原因**:
1. 无需后端开发，人力匹配
2. 免费额度可支撑冷启动
3. 3天完成接入，符合时间线
4. 按量付费，无固定成本压力

### 案例2: 成熟企业（推荐混合方案）

**背景**:
- 已有技术团队20人
- 需支持小程序+App+Web
- 日均PV 100万+

**决策**: ⚠️ 混合架构

**原因**:
1. 小程序端用云开发AI降低成本
2. App/Web用自建API保证一致性
3. 已有运维团队，可承担复杂度
4. 需要深度定制推荐算法

### 案例3: 个人开发者（推荐云开发AI）

**背景**:
- 独立开发者
- 兼职项目
- 目标：月收入 ¥5000

**决策**: ✅ 云开发AI

**原因**:
1. 零运维，专注产品
2. 成本可控，毛利率>90%
3. 快速迭代，试错成本低
4. 微信生态流量红利

---

## 📞 技术支持路径

### 云开发AI问题

```
问题排查路径:
1. 查看微信开发者社区
2. 查阅云开发官方文档
3. 提交云开发工单
4. 联系微信商务经理
```

### 自建方案问题

```
问题排查路径:
1. 查阅DeepSeek API文档
2. 检查服务器日志
3. 联系云服务提供商
4. 自行排查代码问题
```

---

**文档维护**: Aletheia Tech Team  
**更新频率**: 每季度  
**反馈邮箱**: tech@aletheia.app
